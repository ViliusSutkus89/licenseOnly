plugins {
    id 'com.android.library'
    id 'maven-publish'
    id 'signing'
}

group = 'com.viliussutkus89.licenseOnly'

android {
    compileSdk 32
    defaultConfig {
        minSdk 16
        targetSdk 32

        versionCode 1
        versionName '2.4.6'
    }
}

task sourceJar(type: Jar) {
    archiveClassifier.set('sources')
}

task javadocJar(type: Jar) {
    archiveClassifier.set('javadoc')
}

afterEvaluate {
    publishing {
        publications {
            release(MavenPublication) {
                from components.release

                artifactId project.name
                version = android.defaultConfig.versionName

                artifact sourceJar
                artifact javadocJar

                pom {
                    name = project.name
                    description = 'GNU Libtool in computer programming is a software development tool that is part of the GNU build system.'
                    url = 'https://www.gnu.org/software/libtool'
                    packaging = 'aar'
                    inceptionYear = '1996'
                    licenses {
                        license {
                            name = 'GPLv2-or-later'
                            url = 'http://git.savannah.gnu.org/cgit/libtool.git/tree/AUTHORS?h=v2.4.6'
                            distribution = 'repo'
                        }
                    }
                    scm {
                        url = 'http://git.savannah.gnu.org/cgit/libtool.git'
                        connection = 'https://git.savannah.gnu.org/git/libtool.git'
                    }
                    developers {
                        // Developer list obtained from:
                        // http://git.savannah.gnu.org/cgit/libtool.git/tree/AUTHORS?h=v2.4.6
                        developer {
                            name = 'Gordon Matzigkeit'
                            email = 'gord@gnu.org'
                        }
                        developer {
                            name = 'Thomas Tanner'
                            email = 'tanner@ffii.org'
                        }
                        developer {
                            name = 'Alexandre Oliva'
                            email = 'oliva@dcc.unicamp.br'
                        }
                        developer {
                            name = 'Ossama Othman'
                            email = 'ossama@debian.org'
                        }
                        developer {
                            name = 'Robert Boehne'
                            email = 'rboehne@ricardo-us.com'
                        }
                        developer {
                            name = 'Scott James Remnant'
                            email = 'scott@netsplit.com'
                        }
                        developer {
                            name = "Peter O'Gorman"
                            email = 'peter@pogma.com'
                        }
                        developer {
                            name = 'Ralf Wildenhues'
                            email = 'Ralf.Wildenhues@gmx.de'
                        }
                        developer {
                            name = 'Gary V. Vaughan'
                            email = 'gary@gnu.org'
                        }
                        developer {
                            name = 'Bob Friesenhahn'
                            email = 'bfriesen@simple.dallas.tx.us'
                        }
                        developer {
                            name = 'Peter Rosin'
                            email = 'peda@lysator.liu.se'
                        }
                        developer {
                            name = 'Noah Misch'
                            email = 'noah@cs.caltech.edu'
                        }
                        developer {
                            name = 'Charles Wilson'
                            email = 'libtool@cwilson.fastmail.fm'
                        }
                        developer {
                            name = 'Brooks Moses'
                            email = 'bmoses@google.com'
                        }
                    }
                }
            }
        }
    }

    if (System.getenv('SIGNING_KEY')) {
        signing {
            required { true }
            useInMemoryPgpKeys(System.getenv('SIGNING_KEY'), System.getenv('SIGNING_PASS'))
            sign publishing.publications.release
        }
    }
}
